sudo: required
language: node_js
node_js:
    - '11'
services:
    - docker
before_install:
    - openssl aes-256-cbc -K $encrypted_8c848010c37a_key -iv $encrypted_8c848010c37a_iv
      -in deploy_key.enc -out deploy_key -d
    - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
    - yarn install
    - npm run build
    - docker build -t blog-backend .
script:
    - docker tag blog-backend:latest $DOCKER_HUB_USERNAME/blog-backend:production
    - docker push $DOCKER_HUB_USERNAME/blog-backend:production
after_script:
deploy:
    provider: script
    skip_cleanup: true
    script:
        chmod 600 deploy_key && ssh -p $SERVER_PORT -o StrictHostKeyChecking=no
        -i ./deploy_key $SERVER_USERNAME@$SERVER './deploy-front.sh'
    on:
        branch: master
cache: yarn
env:
    global:
        - secure: rFigAbKK2TOB3XzM2NudtoAT3gH/csc7d+LA87H58EydZk2IONumO0AhT3nR5vuLuyv7V9MNcsPlc7cBhTQ85EaXyqn6rx8z/r0FZWHGJZnl4pO8Rhfcqm6IKS6Ht7Ig81dvbdNT7EhmhiqHG2SvvsVZjulGl26lq7smjxp7f5qo5y+wwXi+rFYErosZfTGhUhQ16P81TmW2u1+MgUPWRoOvb898BkBOmbWyw5zQJJzoUS2RD0jFTUgP2Sff47z/sAsOBJyLUhN4/zrbnVVtY0pyeUMbpkh2hXuV6oK7CwTr0LbEAhqgz/k4J1v3XjnTgFY7lfcuMdMVXIkTNdOswYCvZWVhug/dXOFgG7iWYI5XfWSznKmTgpdvmWZMCHCPMI/PhPNyTzlLsKRa7v/N8Eela0DlDC3J2cHC+bDwAMVk2984UnKEtaaD6b6CZoWHlQ4lO3ii1HSZgXNziDBfDjoNIX8ebg4idXDXqcUiR0PKkaZmC3cyYs5I3BjE4eQT8GSPHsQkciOT0AADPz1RM0+PRsnFG+CX08q/O7jXcZmgXxKG1yvItMfS7seRnXSzWqXYMKnH3TP8mfOZ4V4vigquIn5gp+Wt/AYRPemxzEw1fOwk7F7tqEo42UbgDKIBZJ+VVggkUBLL2MIg92vmR2t4fSjm0yM6Imb6wco0X+4=
        - secure: AQRGPWGBMAq5KXB6flUaDGiAxufhqP/bHQlLrjAwl8q9DPpFtXarQysEXG1W8gtQh3XhRvgmaPggPIsoK6R4IDfKym+pYfOnI5SxxT8SP+wOM7Ull7rS4nLSMGXFVdmWdmuttKdC3JyYs2uogc2UUZVHJtcEEzs1bo7xl1dlk5Wt0yU8qb942Ylx4k3y27wX5zMrMyuscr3UkA3j2kUr/6CCxTx4nQKxxAmXMxs0sdcNUeNHDK6IJRW/ySgGmTEgvAx8x249Ysxx2Lqi40q7zs8GetiwR96J45QDAZSE8RH6M9UsYeWll7bahXMNXv0ygS/1nxi1pvaOQLsna4iWIY4qGS5IvEr575WrBO+6IqEAOK1SYKvbKDFQ2cZb5At7pt+lNVXU1/jWXbXRJXBRGQrhboCb6vcbUkUDO9bPIFVAAS8McGa1pGetFI6pvdjkBEwk+lT1UoC0Kx2a8L4rTCudoT1ffRr/9sbUZPkQydwmtsuvQ7fLLIg5Bm11YorOwPlJgkQyzSh2WO9/H10iQfIlUcFH8/nGEaV+prkDreR/GCFkdJmUrTRlsWNWo88+Lqb2ppoIenATVihCaObMVHHq6U2e4cyv9hdcpP4wo0EdPpBfnK18BFQ8iS1ks/LRm5dTGVP/h1tYx2SkKsVw49fI5LIJd05xlTIvNMnrNj4=
        - secure: SQtdcWHWQkOi36dvLwGGuDEazqYyLtVv02fr0v4Ub9/3sFEh1TlEZ4r2HF7AcX9h0Ab/nFgiU+e635Q2FLt3OPsBvm3OcysWnr6Tyv3nh0YDthVCKOWg/6R5N2Vkli9Max9GOg9jwwvaTvrbyg4qF3Mvd1lLp8mbYfIEj/wi+1eVtFRRkLgzd1Zj1Ev8KF/60p4jWW6WKejg8DbXLWwS97bBB7OPjC5Huh/n7fE+S7lgvHzYjR8rOQQjxP+dwLKqFbTtyTDPJjJU9KmnstisjWsNqveDAwPFnPX6AlrUnMovPgUQz4PRcGGrG1cqaUuzIvoQEH80fkgJM0TSwf+jSl1F82IUUtYdSpdTs1Gjv3Gfzt+C34qh3hfWmB4+0Hyislv0eFFo6xcuAaxkY2yRYggnDdkZMIcYcWnHaXk/lbyboM9V5+x7HrIMNc7G+FQ9wQLocZ4zA56ZaZtLsUqYmR7sihUW01qOhI/pa29Y0Yxnm0gD2IHzfWWjLWhWYmHCqKp4D8Juq9b4FwXAA46k6PcFhNs3VDKU2HcbqxtQ1mtCgxX+CJb/wfRiX1PriF1+2wiQ7CW43J1gvKY0YH1wdKFpkC3kXtv9Xb9OTNCt00QqbJp4/0JJJ0oDzzweIKNs/XL8QJ2O6HFFN40bQC23tikb7wYyvYmTuYTmyMxhf04=
        - secure: yVN3OslUMcKUAIO6rG2tYkl901lkDmilc1a34rkqbUjspO2/UA0mcEy5IeMPStn97jeQk2i8ijwDNddBlQsyeru1/5AdpD/6Qna1xMvcvd9WR8LL0nKvWwIj8/1eNKJKxL/QtTiWtcJt8h/HjlLEFwZ3Z9S9kupFipPWAyITEEKZWZruUV7O3JnUGWMuiyrPRFqFdflXRkW457FrmG7+ubUZ8HEzYBZmQy1jcA9V8bN/yUgHsZ4sIoGB4jEtXMl0oRkydDnqKMnHjQ6KH+4fyELBsS9E308dRIpaoDdRi34sQxqi8PtDU0Rh9rwcV8gQUs5ZSaInsBn84ulSM5JwgfEv6EkOfdSX2/xR0an2VvoKLqjR/45lHCPBj7ZsWK4Hoh0N+V/Dcaes5iOvDhwoTHKOdFAfnpERCrVG0dtHt4qMZG8Y0DMJcGG1IogGbmpjqbyuwfVt44d0Dur4VxoenJi7vWxCTs1IcV6/9nxOTQaxs6Jirvl043jPniyea+2CK2pERiwM2EyFrxHhc2rJyFfylgxp+Q67JVKuGYgegI2ZWwhfC+9/bBf2DTlKOHyHUucrm09ebRSKlKNcXEhNGiRj2yjdU9164wJYRlj4yACRfw5PfM3s2cwdGDITgpTeEagz8sI4uyz2bpu7PS4bR9EVBQBGKuEFavRyTLT/Kw4=
        - secure: B7W9Gbp/IoGAh+L5CQrfuyC4BIqzchRCXO0Fjb5rseQhk1pf5hn16Zk+caSNK01btjaNhHotxP+VXfe/TmTKzkEsW0BvVw/wayl6/MxO1V3XCfQEh9ikpfhy5d1Mw3S9UPubBfkTaHC7SBm2CrkF2unSMF7N0U0PrXwl9pJc81rLOCsFPcIjMPli8/giOcuvxtfb9nv/jCdCU15m3I1SRNzzGYNKM8vDrOmGpADjb0hj/9ltYwg2fjwXgL0sst/LfjW/Vv4H5v+GMMgtHfRFGlEstE58geyqJOSMUTqtHN7HDRF4Bvi0zDIqddtOD0QJ1bXaVxzKtMX39hwbCwTr+EBFT+CkkXyV6ceJM/TlyMDHjflNs4w4fM1rXrHjVoCkhuPX9yw6fkK8RkzL02KQaaxUwC9eMxuPytWlZvNCBG8xnB+X8lSrU47/dzllpprPYOgVnAUkxI0ul4iVSeSaYEegrs44omrYD7Eo4lJcR5Qlh6rnmyH9jXZGKnpgEf4Hwow9KjMCO1EXzYJ2xXS/4i4FQ8Z+Rg0twyqy3IJgzkH8AJkPE95MDypu+hO6kY/QO/ttSUOXr12jzgxDxXL8zxpjDvMoG6BEFc8J6VNWmPMfhFEeAElWZhRfuHYh6eBxLtcMhEz1JbMYbCmdV9/OkXlaSf9So5XuTl5stmvXUBE=
        - secure: LiEtaH6E+q2PNFBjxm4oVCHmXzTWVM+zjVcKp+ixAAz9anIpGEfeeqdY2h0gI/JsBk92on02wYEuob1F0mN8sizC2mSgoSJ7ESgxhdqOUPnbP+bUd+1IOh3M9HW90xDYyLInUYxXaA3Nol4KSd5AmUbgtHHA6Wbad0G1dogNjDtXAklXipOZv6DTVkeL8IFLPt03Gt+219QLQwdZu5CXx3uUDCioGSciQG73FIr069+bDx7UmIyTN8yltxWzmcCIdk5siN24fWkauyqAUGRPz4pXS/Ou7NOd/KBdRnMAs2UoBt0ccni3T9sn8o1BNvb7B/e6QRETHnlYOTK0KePCDKfIV5fbYayyz5+Unr337igWg4YZEOA47+Sp4qAu3V056lCCU2IFte11hHPtHWuwL5ZcfW5VpQX6gGHNdcDAa24AmVhjyI4fLkb1VLPtWgLEyNH8P7heC4IU/vSXSGrIHYSxKsrA1iBivxvtTH2IBHKl84Jllu0o9xtrd5DIYeDbUXAivGftRyq/IiwM0y+Wy1uSKsaEPbWOXx6mwQhZ0SUsjT7BbpS6plIJDrQ+hRAYdhbDlQ+ug1EFDbahxZIzrwa+W4TQk86WP7pbdkMqQBXSjmITcLp2osvV1/5fLJX5fFXOv7X4dFXaTDMYEEukVRJ3JSpeUkNxsY5pPk6qSvY=
